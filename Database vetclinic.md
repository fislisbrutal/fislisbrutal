# База данных Ветеринарная клиника (Vetclinic)
> ***Дисклеймер*** - является учёбным проектом по проектированию БД 

Оглавление:
1. [ER-диаграмма](#1)
2. [Связи между таблицами](#2)
3. [Описание параметров по таблицам](#3)
4. [Примеры-бизнес задач](#4)
5. [Рекомендации к репликации и резервному копированию](#5)

<h2 id="1">ER-диаграмма</h2>

> Database Vetclinic - schema public

![image-1](https://github.com/user-attachments/assets/56be5670-5a50-49f3-b1df-d6b45ddaa84a)


<h2 id="2">Связи между таблицами</h2>

0. **Vetclinic**:
   - База данных ветеринарной клиники.
1. **Owner - Animal**:  
   - Один владелец может иметь несколько животных. `(1->N)` 
   - Связь: `Owner.OwnerID` → `Animal.OwnerID`.

2. **Animal - Appointment**:  
   - Одно животное может иметь несколько записей на прием. `(1->N)`  
   - Связь: `Animal.AnimalID` → `Appointment.AnimalID`.

3. **Veterinarian - Appointment**:  
   - Один ветеринар может иметь несколько записей на прием. `(1->N)`  
   - Связь: `Veterinarian.VetID` → `Appointment.VetID`.

4. **Animal - Treatment**:  
   - Одно животное может иметь несколько лечений. `(1->N)`   
   - Связь: `Animal.AnimalID` → `Treatment.AnimalID`.

5. **Veterinarian - Treatment**:  
   - Один ветеринар может проводить несколько лечений. `(1->N)` 
   - Связь: `Veterinarian.VetID` → `Treatment.VetID`.

6. **PriceListForServices - Treatment**:  
   - Одна услуга может быть связана с несколькими лечениями. `(1->N)`  
   - Связь: `PriceListForServices.ServiceID` → `Treatment.ServiceID`.

7. **Animal - MedicalRecord**:  
   - Одно животное может иметь несколько медицинских записей. `(1->N)`   
   - Связь: `Animal.AnimalID` → `MedicalRecord.AnimalID`.

8. **Veterinarian - MedicalRecord**:  
   - Один ветеринар может создавать несколько медицинских записей. `(1->N)`   
   - Связь: `Veterinarian.VetID` → `MedicalRecord.VetID`.

9. **Owner - Invoice**:  
   - Один владелец может иметь несколько счетов. `(1->N)`   
   - Связь: `Owner.OwnerID` → `Invoice.OwnerID`.

10. **Animal - Invoice**:  
    - Одно животное может быть связано с несколькими счетами. `(1->N)`   
    - Связь: `Animal.AnimalID` → `Invoice.AnimalID`.

<h2 id="3">Описание параметров по таблицам</h2>

> Primary key - первичный ключ (далее PK), Foreign key - внешний ключ (далее FK)

## Таблица **Owner** (Владелец)
Содержит информацию о владельцах животных.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `OwnerID`        | `integer`      | Уникальный идентификатор владельца (PK).      |
| `FirstName`      | `varchar(50)`  | Имя владельца.                                |
| `LastName`       | `varchar(50)`  | Фамилия владельца.                            |
| `PhoneNumber`    | `varchar(15)`  | Номер телефона владельца.                     |
| `Email`          | `varchar(100)` | Электронная почта владельца.                  |
| `Address`        | `varchar(255)` | Адрес владельца.                              |

---

### Таблица **Animal** (Животное)
Содержит информацию о животных (пациентах).

| Наименование         | Формат         | Описание                                      |
|----------------------|----------------|-----------------------------------------------|
| `AnimalID`           | `integer`      | Уникальный идентификатор животного (PK).      |
| `OwnerID`            | `integer`      | Идентификатор владельца (FK).                 |
| `Name`               | `varchar(50)`  | Имя животного.                                |
| `Species`            | `varchar(50)`  | Вид животного       |
| `Breed`              | `varchar(50)`  | Порода животного.                             |
| `DateOfBirth`        | `date`         | Дата рождения животного.                      |
| `Gender`             | `varchar(10)`  | Пол животного.                                |
| `Color`              | `varchar(50)`  | Окрас животного.                              |
| `MedicalHistoryNotes`| `text`         | Заметки о медицинской истории животного.      |

---

### Таблица **Veterinarian** (Ветеринар)
Содержит информацию о ветеринарах.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `VetID`          | `integer`      | Уникальный идентификатор ветеринара (PK).     |
| `FirstName`      | `varchar(50)`  | Имя ветеринара.                               |
| `LastName`       | `varchar(50)`  | Фамилия ветеринара.                           |
| `PhoneNumber`    | `varchar(15)`  | Номер телефона ветеринара.                    |
| `Email`          | `varchar(100)` | Электронная почта ветеринара.                 |
| `Specialization` | `varchar(100)` | Специализация ветеринара |

---

### Таблица **PriceListForServices** (Прайс-лист услуг)
Содержит информацию об услугах и их стоимости.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `ServiceID`      | `integer`      | Уникальный идентификатор услуги (PK).         |
| `ServiceName`    | `varchar(100)` | Название услуги        |
| `Description`    | `text`         | Описание услуги.                              |
| `Cost`           | `decimal(10,2)`| Стоимость услуги.                             |

---

### Таблица **Appointment** (Запись на прием)
Содержит информацию о записях на прием.

| Наименование       | Формат         | Описание                                      |
|--------------------|----------------|-----------------------------------------------|
| `AppointmentID`    | `integer`      | Уникальный идентификатор записи (PK).         |
| `AnimalID`         | `integer`      | Идентификатор животного (FK).                 |
| `VetID`            | `integer`      | Идентификатор ветеринара (FK).                |
| `AppointmentDate`  | `date`         | Дата записи на прием.                         |
| `AppointmentTime`  | `time`         | Время записи на прием.                        |
| `ReasonForVisit`   | `varchar(255)` | Причина визита         |
| `Status`           | `varchar(50)`  | Статус записи       |

---

### Таблица **Treatment** (Лечение)
Содержит информацию о проведенных лечениях.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `TreatmentID`    | `integer`      | Уникальный идентификатор лечения (PK).        |
| `AnimalID`       | `integer`      | Идентификатор животного (FK).                 |
| `VetID`          | `integer`      | Идентификатор ветеринара (FK).                |
| `ServiceID`      | `integer`      | Идентификатор услуги (FK).                    |
| `TreatmentDate`  | `date`         | Дата проведения лечения.                      |
| `Description`    | `text`         | Описание лечения.                             |
| `Cost`           | `decimal(10,2)`| Стоимость лечения.                            |

---

### Таблица **MedicalRecord** (Медицинская карта)
Содержит информацию о медицинских записях животных.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `RecordID`       | `integer`      | Уникальный идентификатор записи (PK).         |
| `AnimalID`       | `integer`      | Идентификатор животного (FK).                 |
| `VetID`          | `integer`      | Идентификатор ветеринара (FK).                |
| `RecordDate`     | `date`         | Дата записи в медицинской карте.              |
| `Diagnosis`      | `text`         | Диагноз.                                      |
| `Prescription`   | `text`         | Назначенное лечение.                          |
| `Notes`          | `text`         | Дополнительные заметки.                       |

---

### Таблица **Invoice** (Счет)
Содержит информацию о счетах, выставленных владельцам.

| Наименование     | Формат         | Описание                                      |
|------------------|----------------|-----------------------------------------------|
| `InvoiceID`      | `integer`      | Уникальный идентификатор счета (PK).          |
| `OwnerID`        | `integer`      | Идентификатор владельца (FK).                 |
| `AnimalID`       | `integer`      | Идентификатор животного (FK).                 |
| `InvoiceDate`    | `date`         | Дата выставления счета.                       |
| `TotalAmount`    | `decimal(10,2)`| Общая сумма счета.                            |
| `PaymentStatus`  | `varchar(50)`  | Статус оплаты |

<h2 id="4">Примеры бизнес-задач</h2>

### 1. Управление записями на прием

Таблица Запись на прием (`Appointment`) позволяет отслеживать все записи на прием, включая дату, время, ветеринара и причину посещения.

###  2. Выставление счетов

Таблица Счет (`Invoice`) позволяет:
- Создавать счета на основе проведенных процедур и услуг.
- Отследить статус платежа за процедуры и услуги.
- Расчитать доход за определенный период.

### 3. Управление ценами на услуги

Таблица Прайс-лист услуг (`PriceListForServices`) предоставляет централизованный перечень услуг и их стоимость. При помощи неё возможно:

- Обеспечить согласованность цен на все виды лечения.
- Легко обновить стоимость услуг.
- Проанализировать какие услуги являются наиболее выгодными или наиболее дорогими.

### 4. Ведение историй болезней животных

Таблица Медицинская карта (`MedicalRecord`) позволяет:

- Хранить и извлекать историю болезни каждого животного.
- Отслеживать диагнозы, рецепты и заметки с течением времени.
- Предоставляет ветеринарам быстрый доступ к полной истории болезни животного.

### 5. Отслеживание лечения

Таблица Лечение (`Treatment`) позволяет: 

- Хранить подробную информацию о каждом лечении, включая предоставляемые услуги, стоимость и ветеринара.

<h2 id="5">Рекомендации к репликации и резервному копированию</h2>

В рамках рассматриваемой базы данных мы используем классический PostgreSQL

### Репликация
- Настроить `Master-Slave` репликацию. `Master` - основная база данных для операций записи (добавление новых записей о животных, владельцах, лечениях).`Slave` - реплика для операций чтения (поиск информации о животных, генерация отчетов).
- В случае если у нас несколько филиалов нам необходимо предусмотреть реплики в каждом филиале для ускорения доступа к данным.
- Использовать инструмент `pg_stat_replication` для мониторинга репликации

### Резервное копирование

- Физическое резервное копирование: Ежедневное создание полных бэкапов с помощью `pg_basebackup`.
- Логическое резервное копирование: Еженедельный экспорт данных с помощью `pg_dump` для дополнительной защиты.
- Включить архивирование WAL-файлов для возможности восстановления на любой момент времени. Хранить WAL-файлы в облачном хранилище AWS S3.

